<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AI Math Solver – Mobile UI</title>
<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
<style>
:root{
  --bg:#0F1115; --panel:#191E27; --chip:#242B38;
  --text:#E7EAF2; --muted:#A9B1C3; --primary:#3B82F6;
  --border:#232938; --grad:linear-gradient(180deg,#FF4D67 0%,#FF7A3D 100%);
}
@media (prefers-color-scheme:light){
  :root{--bg:#F7F8FB;--panel:#FFFFFF;--chip:#F1F4F8;
  --text:#0F172A;--muted:#64748B;--border:#E5E7EB;}
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);
font-family:"Cairo",system-ui,-apple-system,Segoe UI,Roboto}
.wrap{max-width:980px;margin:auto;padding:16px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}
.display{background:var(--panel);border:1px solid var(--border);
border-radius:32px;padding:20px 20px 24px;margin:8px 0 14px;
box-shadow:0 10px 30px rgba(0,0,0,.25)}
.expr{color:var(--muted);font-size:18px;text-align:right;min-height:28px}
.result{margin-top:4px;font-weight:800;font-size:42px;text-align:right}
.pad{background:var(--panel);border:1px solid var(--border);
border-radius:28px;padding:16px;position:relative}
.row{display:flex;gap:12px;justify-content:space-between;margin-bottom:12px}
.btn{width:64px;height:64px;border-radius:50%;border:1px solid var(--border);
background:var(--chip);color:var(--text);font-size:20px;font-weight:700;
display:flex;align-items:center;justify-content:center;cursor:pointer;
transition:transform .06s ease}
.btn:active{transform:scale(.96)}
.btn.ac{color:#FF4D67;font-weight:800}
.btn.op{color:var(--muted)}
.fab{position:absolute;inset-inline-start:16px;inset-block-end:16px;
width:64px;height:128px;border-radius:999px;border:none;color:#fff;
background:var(--grad);box-shadow:0 14px 40px rgba(255,100,60,.35);
font-size:28px;font-weight:900;cursor:pointer}
.card{background:var(--panel);border:1px solid var(--border);
border-radius:28px;padding:16px}
#plot{width:100%;aspect-ratio:1/1;height:auto;border:1px solid var(--border);
border-radius:16px;background:#0E1016;overflow:hidden}
@media(max-width:768px){#plot{aspect-ratio:auto;height:60vh}}
.badge{display:inline-block;padding:6px 10px;border-radius:999px;
font-size:12px;border:1px solid}
.ok{background:rgba(16,185,129,.12);color:#10B981;border-color:#10B981}
.warn{background:rgba(245,158,11,.12);color:#F59E0B;border-color:#F59E0B}
.err{background:rgba(239,68,68,.14);color:#EF4444;border-color:#EF4444}
/* كرت خطوات الحل */
.steps{display:grid;gap:8px;margin-top:6px}
.step{background:#11151d;border:1px solid var(--border);border-radius:12px;
padding:8px 10px;position:relative;padding-right:28px;line-height:1.4}
.step::before{content:counter(stepCounter) "➜";counter-increment:stepCounter;
position:absolute;right:6px;color:var(--primary);font-size:12px}
.steps{counter-reset:stepCounter}
</style>
</head>
<body>
<div class="wrap">
  <div class="grid">

    <!-- يسار: الرسم -->
    <section class="card"><div id="plot"></div></section>

    <!-- يمين: شاشة + أزرار -->
    <section>
      <div class="display">
        <div id="expr" class="expr">اكتب معادلة…</div>
        <div id="res" class="result">= —</div>
      </div>

      <div class="pad">
        <div class="row">
          <div class="btn op" onclick="addTok('(')">(</div>
          <div class="btn op" onclick="addTok(')')">)</div>
          <div class="btn op" onclick="addTok('%')">%</div>
          <div class="btn op" onclick="addTok('/')">÷</div>
          <div class="btn op" onclick="back()">⌫</div>
        </div>
        <div class="row">
          <div class="btn" onclick="addTok('7')">7</div>
          <div class="btn" onclick="addTok('8')">8</div>
          <div class="btn" onclick="addTok('9')">9</div>
          <div class="btn op" onclick="addTok('*')">×</div>
          <div class="btn op" onclick="addTok('^')">xʸ</div>
        </div>
        <div class="row">
          <div class="btn" onclick="addTok('4')">4</div>
          <div class="btn" onclick="addTok('5')">5</div>
          <div class="btn" onclick="addTok('6')">6</div>
          <div class="btn op" onclick="addTok('-')">−</div>
          <div class="btn op" onclick="addTok('y=')">y=</div>
        </div>
        <div class="row">
          <div class="btn" onclick="addTok('1')">1</div>
          <div class="btn" onclick="addTok('2')">2</div>
          <div class="btn" onclick="addTok('3')">3</div>
          <div class="btn op" onclick="addTok('+')">+</div>
          <div class="btn op" onclick="addTok('x')">x</div>
        </div>
        <div class="row" style="margin-bottom:0">
          <div class="btn ac" onclick="clearAll()">AC</div>
          <div class="btn" onclick="addTok('0')">0</div>
          <div class="btn" onclick="addTok('.')">.</div>
          <div class="btn op" onclick="addTok('=')">= (نص)</div>
          <div class="btn op" onclick="addTok('=0')">=0</div>
        </div>
        <button class="fab" onclick="solveEq()">=</button>
      </div>

      <div id="status" class="badge ok" style="display:none;margin:12px 4px 0 0">✔ تم</div>

      <!-- كرت خطوات الحل -->
      <div class="card" style="margin-top:12px">
        <div class="steps" id="steps"><div class="step">— لا توجد خطوات —</div></div>
      </div>
    </section>
  </div>
</div>

<script>
let expr='';const exprEl=document.getElementById('expr'),
resEl=document.getElementById('res'),statusEl=document.getElementById('status'),
plotEl=document.getElementById('plot'),stepsEl=document.getElementById('steps');

function showStatus(t,txt){statusEl.style.display='inline-block';
statusEl.className='badge '+(t==='ok'?'ok':t==='warn'?'warn':'err');statusEl.textContent=txt;}
function hideStatus(){statusEl.style.display='none';}
function render(head='= —'){exprEl.textContent=(expr?expr.replaceAll('**','^'):'اكتب معادلة…');
resEl.textContent=head;}
function addTok(tok){if(tok==='^'){expr+='**';render();return;}
expr+=tok;render();}
function back(){if(expr.endsWith('**'))expr=expr.slice(0,-2);
else expr=expr.slice(0,-1);render();}
function clearAll(){expr='';render();hideStatus();stepsEl.innerHTML='<div class="step">— لا توجد خطوات —</div>';plotWelcome();}

/* --- منطق الحل --- */
function detectType(s){if(/{|;|,/.test(s)&&/=/.test(s))return'system';
if(/\^2|x\*\*2/.test(s)&&/=0/.test(s))return'quadratic';
if(/^y=/.test(s)||(/x/.test(s)&&/=/.test(s)&&/y/.test(s)))return'line';return'unknown';}
function safeEvalY(rhs,x){const js=rhs.replace(/\^/g,'**').replace(/x/g,`(${x})`);
return Function(`"use strict";return(${js});`)();}
function solveSimple(exprIn){
 const s=exprIn.replace(/\s+/g,''),t=detectType(s);let draw=null,headline='= —';const steps=[];
 if(t==='line'){let rhs;if(s.startsWith('y=')){rhs=s.split('=')[1];steps.push('الصيغة: y = m x + b');}
 else{const[L,R]=s.split('='),SR=(L+'-('+R+')').replace(/=0$/,'');
 const by=SR.match(/([+\-]?\d*\.?\d*)y/);
 if(!by)return{draw:null,headline:'✖ صيغة غير مفهومة',steps:['تحويل إلى y=... فشل']};
 const b=by[1]===''||by[1]==='+'?1:(by[1]==='-'?-1:parseFloat(by[1]));
 const rest=SR.replace(/([+\-]?\d*\.?\d*)y/,'0');rhs=`(-(${rest}))/(${b})`;
 steps.push('حوّلنا للصيغة: y = m x + b');}
 try{const m=(safeEvalY(rhs,1)-safeEvalY(rhs,0)),b0=safeEvalY(rhs,0);
 steps.push(`الميل (m) = ${m.toFixed(2)}`);steps.push(`تقاطع y (b) = ${b0.toFixed(2)}`);
 let x0=null,X=[-10,-5,-2,-1,0,1,2,5,10];for(let i=1;i<X.length;i++){const f1=safeEvalY(rhs,X[i-1]),f2=safeEvalY(rhs,X[i]);
 if((f1<=0&&f2>=0)||(f1>=0&&f2<=0)){const tt=Math.abs(f1)/(Math.abs(f1)+Math.abs(f2));x0=X[i-1]+tt*(X[i]-X[i-1]);break;}}
 if(x0!=null)steps.push(`تقاطع المحور x: x = ${x0.toFixed(2)}`);}catch{}
 headline=`= y = ${rhs.replaceAll('**','^')}`;draw={kind:'line',rhs};}
 else if(t==='quadratic'){const[L,R]=s.split('='),poly=`${L}-(${R})`.replace(/=0$/,'');
 steps.push('حوّلنا للصيغة القياسية: f(x)=0');steps.push('نرسم f(x) ونحدّد الجذور.');
 headline='= تربيعية';draw={kind:'quad',poly};}
 else if(t==='system'){const p=s.replace(/[{}]/g,'').split(/;|,/).map(v=>v.trim()).filter(Boolean);
 if(p.length>=2){steps.push('نرسم المعادلتين ونستخرج نقطة التقاطع.');
 headline='= نظام خطي';draw={kind:'sys',e1:p[0],e2:p[1]};}
 else{steps.push('الصيغة ناقصة لمعادتين.');headline='✖ صيغة نظام ناقصة';}}
 else{if(s.startsWith('y=')){const rhs=s.split('=')[1];
 steps.push('تم تفسيرها كدالة عامة y=f(x).');headline='= دالة عامة';draw={kind:'quad',poly:rhs};}
 else{steps.push('ما فهمت النوع. جرّب: y=2*x+3 أو x^2-5x+6=0 أو {y=2*x+3; y=-x+1}');
 headline='✖ صيغة غير واضحة';}}
 return{draw,headline,steps};
}

/* --- الرسم --- */
function baseLayout(){
  return {
    autosize:true,
    plot_bgcolor:'#0E1016',
    paper_bgcolor:'#0E1016',

    // المحور X
    xaxis:{
      range:[-10,10],
      dtick:1,
      showgrid:true,
      gridcolor:'#2A3142',
      zeroline:true,             // يرسم المحور X الحقيقي
      zerolinecolor:'#ffffff',   // لونه أبيض واضح
      zerolinewidth:4,           // سماكته
      linecolor:'#ffffff',       // اللون الأبيض للحافة السفلية
      linewidth:3,
      mirror:true,
      showline:true,
      ticks:'outside',
      scaleanchor:'y',
      scaleratio:1,
      tickfont:{color:'#E7EAF2', size:12}
    },

    // المحور Y
    yaxis:{
      range:[-10,10],
      dtick:1,
      showgrid:true,
      gridcolor:'#2A3142',
      zeroline:true,             // يرسم المحور Y الحقيقي
      zerolinecolor:'#ffffff',   // أبيض أيضًا
      zerolinewidth:4,           // نفس السماكة
      linecolor:'#ffffff',
      linewidth:3,
      mirror:true,
      showline:true,
      ticks:'outside',
      tickfont:{color:'#E7EAF2', size:12}
    },

    margin:{l:40,r:20,t:30,b:40},
    showlegend:true,
    legend:{
      orientation:'h',
      x:0,
      y:1.1,
      font:{color:'#E7EAF2'}
    }
  };
}

function plotWelcome(){Plotly.newPlot(plotEl,[],baseLayout(),
{responsive:true,displayModeBar:false,staticPlot:window.innerWidth<768});}
function plotLine(rhs){
 const X=[];for(let i=-10;i<=10;i+=0.1)X.push(+i.toFixed(1));
 const Y=X.map(x=>safeEvalY(rhs,x));
 const trace={x:X,y:Y,type:'scatter',mode:'lines',name:`y=${rhs.replaceAll('**','^')}`,
 line:{width:3}};
 Plotly.newPlot(plotEl,[trace],baseLayout(),
 {responsive:true,displayModeBar:false,staticPlot:window.innerWidth<768});
}
function plotQuadratic(poly){plotLine(poly);}
function plotSystem(e1,e2){
 function toRHS(eq){const s=eq.replace(/\s+/g,'');
 if(s.startsWith('y='))return s.slice(2);
 if(s.includes('=')){const[L,R]=s.split('='),SR=(L+'-('+R+')').replace(/=0$/,'');
 const by=SR.match(/([+\-]?\d*\.?\d*)y/);if(!by)return null;
 const b=by[1]===''||by[1]==='+'?1:(by[1]==='-'?-1:parseFloat(by[1]));
 const rest=SR.replace(/([+\-]?\d*\.?\d*)y/,'0');return`(-(${rest}))/(${b})`;}
 return null;}
 const r1=toRHS(e1),r2=toRHS(e2),X=[];for(let i=-10;i<=10;i+=0.1)X.push(+i.toFixed(1));
 const traces=[];if(r1)traces.push({x:X,y:X.map(x=>safeEvalY(r1,x)),type:'scatter',mode:'lines',name:e1,line:{width:3}});
 if(r2)traces.push({x:X,y:X.map(x=>safeEvalY(r2,x)),type:'scatter',mode:'lines',name:e2,line:{width:3}});
 Plotly.newPlot(plotEl,traces,baseLayout(),{responsive:true,displayModeBar:false,staticPlot:window.innerWidth<768});
}

/* --- الزر --- */
function renderSteps(list){stepsEl.innerHTML='';
(list&&list.length?list:['—']).forEach(s=>{const d=document.createElement('div');
d.className='step';d.textContent=s;stepsEl.appendChild(d);});}
function solveEq(){
 hideStatus();
 if(!expr.trim()){render('✖ اكتب معادلة أول');showStatus('err','✖ اكتب معادلة أول');
 stepsEl.innerHTML='<div class="step">— لا توجد خطوات —</div>';plotWelcome();return;}
 const res=solveSimple(expr);render(res.headline||'= تم');renderSteps(res.steps);
 if(res.draw){if(res.draw.kind==='line')plotLine(res.draw.rhs);
 if(res.draw.kind==='quad')plotQuadratic(res.draw.poly);
 if(res.draw.kind==='sys')plotSystem(res.draw.e1,res.draw.e2);
 showStatus('ok','✔ تم الحل والرسم');}
 else{showStatus('warn','⚠ ما قدر يرسم—عدّل الصيغة');plotWelcome();}
}

render();plotWelcome();
</script>
</body>
</html>
